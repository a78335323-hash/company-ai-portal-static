<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Portal AI</title>

<style>
body { margin:0; font-family:Arial; display:flex; height:100vh; }

/* SIDEBAR */
.sidebar { width:270px; padding:14px; color:white; display:flex; flex-direction:column; justify-content:space-between; background:#2ecc71; }

/* PULSANTI SIDEBAR */
.sidebar-btn { width:100%; padding:12px; margin-bottom:10px; border-radius:10px; font-size:14px; cursor:pointer; text-align:center; background:rgba(255,255,255,0.18); border:1px solid rgba(255,255,255,0.45); box-sizing:border-box; }
.sidebar-btn:hover { background: rgba(255,255,255,0.28); }

/* CERCA CHAT */
.search-wrapper { position:relative; width:100%; display:flex; align-items:center; justify-content:center; }
.search-wrapper input { width:100%; background:transparent; border:none; outline:none; color:white; padding:12px; text-align:center; font-size:14px; }

/* CHAT LIST + DELETE X */
.chat-title { font-size:13px; opacity:0.85; margin:14px 0 6px; }
.chat-item { padding:8px; border-radius:8px; cursor:pointer; font-size:14px; display:flex; justify-content:space-between; align-items:center; }
.chat-item:hover { background: rgba(255,255,255,0.18); }
.chat-item .delete-btn { color:red; cursor:pointer; font-weight:bold; margin-left:8px; }

/* PROFILO */
.profile-box { padding:10px; border-radius:10px; background:rgba(255,255,255,0.18); display:flex; align-items:center; }
.avatar { width:34px; height:34px; border-radius:50%; background:white; color:#333; font-weight:bold; display:flex; align-items:center; justify-content:center; margin-right:8px; }
.profile-name { flex:1; font-size:13px; }
.change { background:white; color:#333; border:none; font-size:11px; padding:4px 8px; border-radius:6px; cursor:pointer; }

/* MAIN */
.main { flex:1; padding:30px; position:relative; display:flex; justify-content:center; background:#f7f7f7; }
.container { width:88%; display:flex; flex-direction:column; }

/* LOGO */
#logoLink { position:absolute; top:5px; right:10px; }
#logo { width:90px; cursor:pointer; }

/* CHAT FINESTRA */
.chat { flex:1; background:white; border-radius:16px; padding:22px; overflow-y:auto; box-shadow:0 6px 18px rgba(0,0,0,0.18); }
.msg-user, .msg-ai { margin:12px 0; display:flex; }
.msg-user { justify-content:flex-end; }
.msg-ai { justify-content:flex-start; }
.msg-user span, .msg-ai span { padding:12px 16px; border-radius:16px; max-width:75%; white-space:pre-wrap; word-wrap:break-word; font-size:15px; }
.msg-user span { background:#dcf8c6; }
.msg-ai span { background:#f1f1f1; }

/* INPUT */
.input { margin-top:12px; display:flex; align-items:center; }
textarea { flex:1; resize:none; padding:14px; border-radius:12px; border:1px solid #ccc; min-height:48px; max-height:160px; font-size:15px; }
.send { margin-left:10px; padding:0 22px; border-radius:12px; border:none; color:white; cursor:pointer; font-size:15px; background:#2ecc71; }

/* MICROFONO */
.mic-btn { margin-right:10px; width:44px; height:44px; border-radius:50%; border:none; background:#4285f4; color:white; font-size:20px; cursor:pointer; display:flex; align-items:center; justify-content:center; }

/* NUOVI PULSANTI FUORI DAL VERDE */
.top-buttons {
  position:absolute;
  top:10px;
  left:10px;
  display:flex;
  flex-direction:column;
  gap:6px;
  z-index:9999;
}
.top-buttons button{
  padding:8px 12px;
  border-radius:6px;
  border:1px solid #aaa;
  background:white;
  cursor:pointer;
}
.top-buttons button:hover{ background:#eee; }
</style>
</head>

<body>

<!-- PULSANTI FINALI -->
<div class="top-buttons">
  <button id="saveBtn">Salva chat</button>
  <button id="downloadBtn">Scarica .txt</button>
</div>

<!-- SIDEBAR -->
<div class="sidebar" id="sidebar">
  <div>
    <div class="sidebar-btn" id="newChatBtn">Nuova chat</div>
    <div class="sidebar-btn search-wrapper">
      <input id="search" placeholder="Cerca chat">
    </div>
    <div class="sidebar-btn" id="promemoriaBtn">Promemoria</div>
    <div class="sidebar-btn" id="telefonateBtn">Telefonate</div>

    <div class="chat-title">Le tue chat</div>
    <div id="chatList"></div>
  </div>

  <div class="profile-box">
    <div class="avatar" id="avatar"></div>
    <div class="profile-name" id="profileName"></div>
    <button class="change" id="changeUserBtn">cambia</button>
  </div>
</div>

<!-- AREA CHAT -->
<div class="main">
  <a id="logoLink" target="_blank"><img id="logo"></a>
  <div class="container">
    <div class="chat" id="chat"></div>

    <div class="input" id="inputBox">
      <button class="mic-btn" id="mic">ðŸŽ¤</button>
      <textarea id="msg" placeholder="Scrivi un messaggio..."></textarea>
      <button class="send" id="send">Invia</button>
    </div>
  </div>
</div>

<script>
/* ===============================
   VARIABILI
=================================*/
let chatHistory=[];
let chatModified=false;

const chat=document.getElementById("chat");
const msg=document.getElementById("msg");
const sendBtn=document.getElementById("send");
const saveBtn=document.getElementById("saveBtn");
const downloadBtn=document.getElementById("downloadBtn");
const chatList=document.getElementById("chatList");

/* ===============================
   MESSAGGI
=================================*/
function ai(text){
 chat.innerHTML+=`<div class="msg-ai"><span>${text}</span></div>`;
 chat.scrollTop=chat.scrollHeight;
}

function userMsg(text){
 chat.innerHTML+=`<div class="msg-user"><span>${text}</span></div>`;
 chat.scrollTop=chat.scrollHeight;
 chatModified=true;
}

/* ===============================
   AVVIO CHAT
=================================*/
ai("Come posso aiutarti?");

/* ===============================
   SALVA CHAT
=================================*/
function saveChat(){
 if(chatHistory.length===0){ alert("Niente da salvare"); return; }

 let name=prompt("Nome della chat:");

 if(!name) return;

 let saved=JSON.parse(localStorage.getItem("savedChats")||"[]");
 saved.push({name:name,history:chatHistory});
 localStorage.setItem("savedChats",JSON.stringify(saved));

 addChatToList(name);

 chatHistory=[];
 chat.innerHTML="";
 ai("Come posso aiutarti?");
 chatModified=false;
}

/* ===============================
   LISTA CHAT SALVATE
=================================*/
function addChatToList(name){
 const div=document.createElement("div");
 div.className="chat-item";
 div.innerHTML=`<span>${name}</span><span class="delete-btn">Ã—</span>`;

 /* elimina */
 div.querySelector(".delete-btn").onclick=(e)=>{
   e.stopPropagation();
   if(confirm("Sei sicuro di voler eliminare questa chat?")){
     let saved=JSON.parse(localStorage.getItem("savedChats")||"[]");
     saved=saved.filter(c=>c.name!==name);
     localStorage.setItem("savedChats",JSON.stringify(saved));
     div.remove();
   }
 };

 /* apri */
 div.onclick=()=>{
   if(chatModified && !confirm("Modifiche non salvate. Continuare?")) return;

   const saved=JSON.parse(localStorage.getItem("savedChats")||"[]");
   const c=saved.find(x=>x.name===name);

   if(!c) return;

   chat.innerHTML="";
   chatHistory=c.history;

   chatHistory.forEach(m=>{
     if(m.role==="user") userMsg(m.content);
     else ai(m.content);
   });

   chatModified=false;
 };

 chatList.appendChild(div);
}

/* ricostruisci lista all'avvio */
JSON.parse(localStorage.getItem("savedChats")||"[]").forEach(c=>addChatToList(c.name));

/* ===============================
   SCARICA TXT
=================================*/
function downloadChat(){
 if(chatHistory.length===0){ alert("Niente da scaricare"); return; }

 let name=prompt("Nome file:");

 if(!name) return;

 let text=chatHistory.map(m=>(m.role==="user"?"Utente: ":"AI: ")+m.content).join("\n");

 let a=document.createElement("a");
 a.href=URL.createObjectURL(new Blob([text],{type:"text/plain"}));
 a.download=name+".txt";
 a.click();
}

/* ===============================
   ASSOCIA PULSANTI
=================================*/
saveBtn.onclick=saveChat;
downloadBtn.onclick=downloadChat;

/* ===============================
   INVIO MESSAGGIO
=================================*/
sendBtn.onclick=async()=>{
 if(!msg.value.trim())return;

 const text=msg.value;
 msg.value="";

 userMsg(text);
 chatHistory.push({role:"user",content:text});

 ai("Sto elaborando la risposta...");
};

/* ENTER */
msg.addEventListener("keydown",e=>{
 if(e.key==="Enter"&&!e.shiftKey){
   e.preventDefault();
   sendBtn.click();
 }
});
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Area personale AI</title>

<style>
body{
  margin:0;
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  height:100vh;
  display:flex;
  flex-direction:column;
}

header{
  background:#2ecc71;
  padding:14px 20px;
  color:white;
  font-size:18px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

#userInfo{
  font-weight:bold;
}

#logout{
  background:#e74c3c;
  border:none;
  padding:8px 12px;
  border-radius:8px;
  color:white;
  cursor:pointer;
}

main{
  flex:1;
  display:flex;
  padding:10px;
  gap:10px;
}

#left{
  width:25%;
  background:white;
  border-radius:12px;
  padding:12px;
  box-shadow:0 5px 15px rgba(0,0,0,0.1);
}

#right{
  flex:1;
  background:white;
  border-radius:12px;
  padding:12px;
  box-shadow:0 5px 15px rgba(0,0,0,0.1);
  display:flex;
  flex-direction:column;
}

/* CHAT */
#chat{
  flex:1;
  overflow-y:auto;
  padding:10px;
  border:1px solid #ddd;
  border-radius:10px;
  margin-bottom:10px;
}

.msg-user{
  text-align:right;
  margin:6px 0;
}

.msg-user span{
  display:inline-block;
  background:#2ecc71;
  color:white;
  padding:8px 10px;
  border-radius:10px;
}

.msg-ai{
  text-align:left;
  margin:6px 0;
}

.msg-ai span{
  display:inline-block;
  background:#ecf0f1;
  padding:8px 10px;
  border-radius:10px;
}

#msg{
  width:100%;
  resize:none;
  height:48px;
  padding:10px;
  border-radius:10px;
  border:1px solid #ccc;
}

#sendBtn{
  margin-top:8px;
  width:160px;
  padding:10px;
  border:none;
  border-radius:10px;
  background:#3498db;
  color:white;
  cursor:pointer;
}
</style>
</head>

<body>

<header>
  <div>ðŸ’¼ Portale AI aziendale</div>
  <div id="userInfo"></div>
  <button id="logout">Logout</button>
</header>

<main>

<div id="left">
  <h3>Dati utente</h3>
  <p>Azienda: <b id="companyName"></b></p>
  <p>Operatore: <b id="userName"></b></p>
</div>

<div id="right">
  <h3>Chat AI</h3>

  <div id="chat"></div>

  <textarea id="msg" placeholder="Scrivi il messaggio..."></textarea>
  <button id="sendBtn">Invia</button>
</div>

</main>

<script>
// recupero dati salvati dal login
const company = localStorage.getItem("company") || "Sconosciuta";
const user = localStorage.getItem("user") || "Operatore";

document.getElementById("companyName").textContent = company;
document.getElementById("userName").textContent = user;
document.getElementById("userInfo").textContent = company + " | " + user;

// logout
document.getElementById("logout").onclick = ()=>{
  localStorage.clear();
  location.href="index.html";
};

const msg = document.getElementById("msg");
const sendBtn = document.getElementById("sendBtn");
const chat = document.getElementById("chat");

// mostra messaggio AI
function ai(text){
  chat.innerHTML += `<div class="msg-ai"><span>${text}</span></div>`;
  chat.scrollTop = chat.scrollHeight;
}

// invio messaggio
sendBtn.onclick = async () => {

  if(!msg.value.trim()) return;

  // mostra messaggio utente
  chat.innerHTML += `<div class="msg-user"><span>${msg.value}</span></div>`;
  chat.scrollTop = chat.scrollHeight;

  const text = msg.value;
  msg.value="";

  ai("Sto elaborando la risposta...");

  try{
    const res = await fetch("https://company-ai-portal-static.onrender.com/chat", {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ message:text })
    });

    const data = await res.json();

    chat.lastChild.remove(); // rimuovi "sto elaborando"

    ai(data.reply || "Nessuna risposta ricevuta");

  }catch(err){
    chat.lastChild.remove();
    ai("Errore di comunicazione con il server");
  }
};

// invio con ENTER
msg.addEventListener("keydown", e=>{
  if(e.key==="Enter" && !e.shiftKey){
    e.preventDefault();
    sendBtn.click();
  }
});
</script>

</body>
</html>
